# MT5バックテスト完全ガイド - Para372 EA

**対象:** MetaTrader 5  
**EA:** Para372 v1.2  
**作成日:** 2026年2月17日

---

## 📑 目次

1. [事前準備](#1-事前準備)
2. [基本的なバックテスト手順](#2-基本的なバックテスト手順)
3. [詳細設定](#3-詳細設定)
4. [最適化の実行](#4-最適化の実行)
5. [結果の見方と分析](#5-結果の見方と分析)
6. [レポートの保存と共有](#6-レポートの保存と共有)
7. [よくある問題と対処法](#7-よくある問題と対処法)
8. [実践的なテストシナリオ](#8-実践的なテストシナリオ)

---

## 1. 事前準備

### 1.1 必要なもの

- ✅ MetaTrader 5がインストール済み
- ✅ Para372_v1.2.mq5がコンパイル済み
- ✅ テストする通貨ペアの履歴データ

### 1.2 EAのコンパイル

**手順:**

1. **MetaEditorを開く**
   - MT5メニュー → ツール → MetaQuotes Language Editor
   - またはF4キーを押す

2. **EAファイルを開く**
   - ファイル → 開く
   - `MQL5/Experts/Para372_v1.2.mq5`を選択

3. **コンパイル実行**
   - F7キーを押す
   - または上部ツールバーの「コンパイル」ボタン

4. **結果確認**
   ```
   ✅ 成功の場合:
   0 error(s), 0 warning(s)
   
   ❌ エラーがある場合:
   エラーメッセージを確認して修正
   ```

### 1.3 履歴データのダウンロード

**重要:** テスト前に十分な履歴データが必要です。

**手順:**

1. **気配値表示を開く**
   - Ctrl+M または 表示 → 気配値表示

2. **通貨ペアを右クリック**
   - テストする通貨ペア（例: USDJPY）を右クリック
   - 「チャート」→「全期間」を選択

3. **各時間足のデータをダウンロード**
   ```
   必要な時間足:
   - M15（15分足）← メイン
   - H1（1時間足）
   - H4（4時間足）
   - D1（日足）← トレンドフィルター用
   ```

4. **確認方法**
   - 各時間足のチャートを開く
   - 左端まで遡れることを確認
   - 少なくとも10年分は欲しい

**ダウンロード完了の目安:**
- チャートが2015年以前まで表示できる
- データの欠損がない（連続している）

---

## 2. 基本的なバックテスト手順

### 2.1 ストラテジーテスターを開く

**方法1: メニューから**
```
表示 → ストラテジーテスター
```

**方法2: ショートカットキー**
```
Ctrl+R
```

**方法3: ツールバー**
```
上部ツールバーのグラフアイコンをクリック
```

### 2.2 基本設定

ストラテジーテスターウィンドウが開いたら、以下を設定:

#### 設定タブ

| 項目 | 設定値 | 説明 |
|------|--------|------|
| **エキスパートアドバイザー** | Para372_v1.2 | テストするEAを選択 |
| **通貨ペア** | USDJPY | テストする通貨ペア |
| **モデル** | 全ティック | 最も正確（推奨） |
| **期間** | 2015.01.01 - 2024.12.31 | 10年間を推奨 |
| **ビジュアルモード** | ☐ | 初回は無効（速度優先） |
| **最適化** | 無効 | 通常テストの場合 |

**詳細:**

**1. エキスパートアドバイザーの選択**
```
ドロップダウンから「Para372_v1.2」を選択
※コンパイル済みでないと表示されません
```

**2. 通貨ペアの選択**
```
推奨順:
1. USDJPY（最も推奨）
2. EURUSD
3. GBPUSD
4. AUDUSD
```

**3. モデルの選択**
```
全ティック（推奨） ← 最も正確
コントロールポイント ← 中程度の精度、速い
始値のみ ← 低精度、非常に速い
```

**4. 期間の設定**
```
開始日: 2015年1月1日
終了日: 2024年12月31日（または最新）

※少なくとも5年以上を推奨
```

**5. 預金（初期資金）**
```
推奨: 1,000,000円
最低: 100,000円

※実際の運用予定額と同じにすると分かりやすい
```

**6. レバレッジ**
```
国内ブローカー: 25:1
海外ブローカー: 100:1, 500:1 など
```

### 2.3 パラメータの設定

**「エキスパート設定」ボタンをクリック**

#### 入力パラメータタブ

標準設定（推奨）:

```
=== 基本設定 ===
Magic = 20250216
RiskPercent = 2.0

=== パラボリックSAR設定 ===
Step15m = 0.001
Step1h = 0.01
Step4h = 0.035
Maximum = 0.2

=== SL/TP設定 ===
ATR_Period = 14
ATR_Multiplier = 1.5
RiskRewardRatio = 1.5

=== トレンドフィルター ===
UseDailyTrend = true
Use4HTrend = false
Use1HTrend = false

=== 負け後の休止機能 ===
UseLossBreak = true
LossBreakCount = 5
LossBreakUnit = "Hours"
LossBreakPeriod = 4

=== 経済指標フィルター ===
UseNewsFilter = false  ← バックテストでは通常OFF
NewsStopMinutesBefore = 60
NewsStopMinutesAfter = 60
StopOn_High_Impact = true
StopOn_Medium_Impact = false

=== 月末・月初停止 ===
UseMonthEndStart = false

=== ログ設定 ===
VerboseLog = false  ← バックテストでは通常OFF
```

**重要な注意:**
```
⚠️ UseNewsFilterはバックテストではfalseに設定
理由: 過去の経済指標データが登録されていないため
```

**OKボタンをクリック**

### 2.4 テストの実行

**「スタート」ボタンをクリック**

#### 実行中の画面

```
進行状況バー: ██████░░░░ 60%
経過時間: 00:15:23
推定残り時間: 00:10:12
```

**処理時間の目安:**

| 期間 | モデル | 所要時間（目安） |
|------|--------|----------------|
| 1年 | 全ティック | 10～30分 |
| 5年 | 全ティック | 1～3時間 |
| 10年 | 全ティック | 3～8時間 |

**テスト中にできること:**
- ✅ 他のチャートを見る
- ✅ 他の通貨ペアを確認
- ❌ MT5を閉じる（中断される）
- ❌ PCをスリープ（中断される）

### 2.5 テスト完了

完了すると自動的に結果タブが表示されます。

---

## 3. 詳細設定

### 3.1 ビジュアルモードの使い方

**目的:** エントリー・決済のタイミングを視覚的に確認

**有効化:**
```
ストラテジーテスター → ビジュアルモード ☑
```

**表示内容:**
- チャート上に売買シグナルが表示
- リアルタイムでポジションの変化が見れる
- ゆっくり確認できる（速度調整可能）

**速度調整:**
```
速度バー: ←遅い 🐌━━●━━🐇 速い→
```

**使い所:**
- 初回テスト時の動作確認
- エントリー条件の視覚的確認
- デバッグ時

**注意:**
- 非常に時間がかかる（10年で数日）
- 通常は短期間（1ヶ月程度）で使用

### 3.2 スプレッドの設定

**重要:** 実際の取引に近づけるため適切に設定

**設定方法:**
```
エキスパート設定 → テスト設定タブ → スプレッド
```

**推奨値:**

| 通貨ペア | ブローカー平均 | バックテスト設定 |
|---------|--------------|----------------|
| USDJPY | 0.2～0.5pips | 1.0pips |
| EURUSD | 0.5～1.0pips | 1.5pips |
| GBPUSD | 1.0～2.0pips | 2.5pips |

**設定理由:**
- 実際より広めに設定 = 保守的な結果
- スリッページも考慮
- より現実的な評価

### 3.3 最適化モード

**3つのモードから選択:**

#### 1. Complete algorithm（完全）
```
すべての組み合わせをテスト
時間: 非常に長い
精度: 最高
推奨: パラメータ数が少ない時
```

#### 2. Genetic algorithm（遺伝的）
```
効率的に最適値を探索
時間: 短～中
精度: 高
推奨: パラメータ数が多い時（通常はこれ）
```

#### 3. All symbols（全通貨ペア）
```
複数通貨で同時テスト
時間: 非常に長い
精度: 通貨ごとに異なる
推奨: ロバスト性確認時
```

---

## 4. 最適化の実行

### 4.1 最適化とは

複数のパラメータの組み合わせを自動的にテストし、最も良い結果を見つける機能。

### 4.2 最適化の手順

#### ステップ1: 最適化モードを有効化

```
ストラテジーテスター → 最適化 ☑
```

#### ステップ2: 最適化するパラメータを選択

**「エキスパート設定」→「入力パラメータ」タブ**

| パラメータ | 開始 | ステップ | 終了 | 優先度 |
|-----------|------|---------|------|--------|
| ATR_Multiplier | 1.0 | 0.2 | 3.0 | ★★★ 高 |
| RiskRewardRatio | 1.0 | 0.25 | 2.5 | ★★★ 高 |
| RiskPercent | 1.0 | 0.5 | 3.0 | ★★ 中 |
| Step15m | 0.0005 | 0.0005 | 0.002 | ★★ 中 |

**設定方法:**
```
1. パラメータの左側のチェックボックス ☑
2. 「開始」「ステップ」「終了」を入力
```

**例: ATR_Multiplierの最適化**
```
開始: 1.0
ステップ: 0.2
終了: 3.0

テストされる値:
1.0, 1.2, 1.4, 1.6, 1.8, 2.0, 2.2, 2.4, 2.6, 2.8, 3.0
（合計11通り）
```

#### ステップ3: 最適化基準を設定

**「最適化」タブ**

```
最適化基準: バランス（推奨）

その他の選択肢:
- プロフィットファクター
- 期待利得
- シャープレシオ
- カスタム
```

#### ステップ4: 最適化を開始

**「スタート」ボタンをクリック**

**進行状況:**
```
パス: 1234/5000 (24.68%)
現在の最良結果: 
バランス: +150,000円
プロフィットファクター: 1.85
```

**所要時間の目安:**

| パラメータ数 | 組み合わせ数 | 所要時間 |
|------------|------------|---------|
| 1つ | 10～50通り | 1～3時間 |
| 2つ | 100～500通り | 5～10時間 |
| 3つ | 1,000～5,000通り | 1～3日 |

### 4.3 最適化結果の確認

**「最適化結果」タブ**

結果が良い順に表示されます：

```
順位 | パス | 損益 | PF | DD | パラメータ
1    | 234  | +250k | 1.95 | 8% | ATR=1.8, RR=1.5
2    | 456  | +240k | 1.88 | 9% | ATR=2.0, RR=1.5
3    | 123  | +235k | 1.82 | 7% | ATR=1.6, RR=1.75
...
```

**重要な指標:**
- ✅ プロフィットファクター（PF）> 1.5
- ✅ 最大ドローダウン（DD）< 10%
- ✅ トレード回数 > 100回

**選択方法:**
1. 結果をダブルクリック
2. 詳細なレポートを確認
3. グラフタブで資産曲線を確認
4. 納得したらそのパラメータを採用

### 4.4 オーバーフィッティングの回避

**危険なサイン:**
```
❌ 最適化期間で利益+300%, 別期間で-50%
❌ パラメータが小数点以下3桁まで調整
❌ 複雑すぎる条件組み合わせ
```

**対策:**
```
✅ パラメータは丸めの数値を使う
   例: 1.47 → 1.5
✅ 複数の期間でテスト
   例: 2015-2019, 2020-2024
✅ 複数の通貨ペアでテスト
```

---

## 5. 結果の見方と分析

### 5.1 結果タブ

テスト完了後、以下の情報が表示されます：

#### 基本情報
```
初期証拠金: 1,000,000円
最終残高: 1,250,000円
総損益: +250,000円
総利益率: +25.00%
```

#### 重要指標

**1. プロフィットファクター（Profit Factor）**
```
総利益 ÷ 総損失

評価:
< 1.0  ❌ 負けている
1.0-1.2 △ ギリギリ
1.2-1.5 ◯ まあまあ
1.5-2.0 ◎ 良い
> 2.0   ★ 優秀
```

**2. 最大ドローダウン（Max Drawdown）**
```
最大の資産減少率

評価:
< 5%   ★ 優秀
5-10%  ◎ 良い
10-20% ◯ 許容範囲
20-30% △ 注意
> 30%  ❌ 危険
```

**3. 勝率（Win Rate）**
```
勝ちトレード数 ÷ 総トレード数

評価:
< 40%  △ 低い（大きく勝つ必要）
40-50% ◯ 普通
50-60% ◎ 良い
> 60%  ★ 優秀
```

**4. トレード回数**
```
最低: 100回以上
推奨: 500回以上
理想: 1000回以上

※少なすぎると信頼性が低い
```

**5. 期待利得（Expected Payoff）**
```
1トレードあたりの平均損益

プラスであること
大きいほど良い
```

**6. シャープレシオ（Sharpe Ratio）**
```
リスクあたりのリターン

評価:
< 0    ❌ 悪い
0-0.5  △ 低い
0.5-1.0 ◯ 普通
1.0-2.0 ◎ 良い
> 2.0   ★ 優秀
```

### 5.2 グラフタブ

#### バランス曲線
```
右肩上がりが理想: ／
横ばいは問題: ―
下降は最悪: ＼
```

**健全なバランス曲線:**
```
        ／
      ／
    ／
  ／
／
```

**問題のあるバランス曲線:**
```
    ／＼
  ／    ＼_
／          ＼
```

#### ドローダウン
```
縦軸: 損失の深さ
横軸: 時間

深いほど危険
回復が遅いほど問題
```

#### その他のグラフ
- 資産分布
- 利益分布
- トレード期間分布

### 5.3 レポートタブ

**詳細な統計情報:**

```
総取引数: 450
売り: 225 (50.0%)
買い: 225 (50.0%)

勝ちトレード: 300 (66.7%)
負けトレード: 150 (33.3%)

最大連勝: 8回
最大連敗: 5回

最大利益トレード: +15,000円
最大損失トレード: -8,500円

平均利益: +5,500円
平均損失: -4,200円
```

**注目ポイント:**
- 最大連敗が10回以内か
- 平均利益 > 平均損失か
- 最大損失が管理可能か

---

## 6. レポートの保存と共有

### 6.1 レポートの保存

**方法1: 自動保存**
```
テスト完了時に自動保存される
場所: MQL5/Tester/XXX.htm
```

**方法2: 手動保存**
```
結果タブ → 右クリック → レポートの保存
形式: HTML, XML, TXT
```

### 6.2 レポートの見方

**HTMLレポートを開く:**
```
ダブルクリックでブラウザが開く
```

**含まれる情報:**
- すべての統計情報
- グラフ
- トレード詳細
- パラメータ設定

### 6.3 複数テストの比較

**Excelなどで比較表を作成:**

```
| テスト | 期間 | PF | DD | 勝率 | 総損益 |
|--------|------|----|----|------|--------|
| Test1  | 2015-2019 | 1.65 | 8% | 65% | +180k |
| Test2  | 2020-2024 | 1.52 | 12% | 62% | +145k |
| Test3  | 2015-2024 | 1.58 | 10% | 64% | +325k |
```

**評価:**
- 複数期間で安定しているか
- 最近の相場でも機能するか
- ドローダウンは許容範囲か

---

## 7. よくある問題と対処法

### 7.1 「履歴データが不足しています」

**症状:**
```
エラー: 履歴データが不足しています
```

**原因:**
- データがダウンロードされていない
- データに欠損がある

**対処法:**
```
1. チャートを開く
2. 各時間足（M15, H1, H4, D1）を表示
3. 左端まで遡る
4. Homeキーを押して最古のデータまで移動
5. 数分待ってダウンロード完了を待つ
6. 再度テスト実行
```

### 7.2 「テストが進まない/固まる」

**症状:**
```
0%のまま動かない
進捗バーが止まる
```

**原因:**
- MT5のバグ
- CPUリソース不足
- データの問題

**対処法:**
```
1. テストを停止
2. MT5を再起動
3. 期間を短くしてテスト
4. ビジュアルモードをOFFに
5. 他のプログラムを閉じる
```

### 7.3 「トレード数が0」

**症状:**
```
テスト完了したがトレード数: 0
```

**原因:**
- エントリー条件が厳しすぎる
- パラメータ設定ミス
- フィルターが全て有効

**対処法:**
```
1. トレンドフィルターを全てfalseに
2. NewsFilterをfalseに確認
3. ログを確認
4. ビジュアルモードで動作確認
```

### 7.4 「結果が極端に良すぎる」

**症状:**
```
プロフィットファクター > 5.0
勝率 > 90%
```

**原因:**
- オーバーフィッティング
- データの問題
- 未来予知バグ

**対処法:**
```
1. 別の期間でテスト
2. 別の通貨ペアでテスト
3. パラメータを丸める
4. コードを見直す
```

### 7.5 「バックテストと実運用で結果が違う」

**原因:**
- スプレッドの違い
- スリッページ
- 約定方式の違い
- データ品質

**対処法:**
```
1. スプレッドを広めに設定
2. フォワードテスト期間を長く取る
3. デモ口座で検証
4. 複数ブローカーで確認
```

---

## 8. 実践的なテストシナリオ

### 8.1 初回動作確認テスト

**目的:** EAが正しく動くか確認

```
期間: 2024年1月～2024年12月（1年間）
通貨ペア: USDJPY
モデル: 全ティック
ビジュアルモード: ON（最初の1週間のみ）
パラメータ: デフォルト
```

**確認項目:**
- ✅ エントリーが発生するか
- ✅ SL/TPが正しく設定されるか
- ✅ ドテンが機能するか
- ✅ エラーが出ないか

### 8.2 標準パフォーマンステスト

**目的:** 長期的な性能を評価

```
期間: 2015年1月～2024年12月（10年間）
通貨ペア: USDJPY
モデル: 全ティック
ビジュアルモード: OFF
パラメータ: 標準設定
```

**評価基準:**
- プロフィットファクター > 1.3
- 最大ドローダウン < 15%
- 勝率 > 60%
- トレード数 > 500回

### 8.3 パラメータ最適化テスト

**目的:** 最適なパラメータを見つける

```
期間: 2015年～2019年（5年間）
通貨ペア: USDJPY
モデル: 全ティック
最適化: ON（遺伝的アルゴリズム）

最適化パラメータ:
- ATR_Multiplier: 1.0～3.0, step 0.2
- RiskRewardRatio: 1.0～2.5, step 0.25
```

**その後:**
```
1. 最良パラメータを選択
2. 2020～2024年でテスト（検証期間）
3. 結果が安定しているか確認
```

### 8.4 ロバストネステスト

**目的:** 複数の条件で安定性を確認

```
テスト1: 2015～2019年
テスト2: 2020～2024年
テスト3: 2015～2024年（全期間）

通貨ペア:
- USDJPY
- EURUSD
- GBPUSD
```

**評価:**
```
すべてのテストで:
- PF > 1.2
- DD < 20%
- 正の損益

→ ロバスト性が高い
```

### 8.5 フィルター効果検証テスト

**目的:** 各フィルターの効果を測定

```
テストA: フィルターなし
  UseDailyTrend = false
  Use4HTrend = false

テストB: 日足フィルターのみ
  UseDailyTrend = true
  Use4HTrend = false

テストC: 両方有効
  UseDailyTrend = true
  Use4HTrend = true
```

**比較:**
```
| テスト | PF | 勝率 | トレード数 |
|--------|----|----|-----------|
| A      | 1.3 | 55% | 800 |
| B      | 1.5 | 65% | 450 |
| C      | 1.7 | 70% | 200 |
```

**結論:** フィルター追加で勝率上昇、機会は減少

---

## 📋 バックテストチェックリスト

### 開始前
- [ ] EAがコンパイル済み
- [ ] 履歴データをダウンロード済み
- [ ] テスト計画を立てた

### テスト中
- [ ] 適切な期間を設定
- [ ] スプレッドを現実的に設定
- [ ] パラメータを確認
- [ ] NewsFilterをOFFに

### テスト後
- [ ] プロフィットファクター確認
- [ ] 最大ドローダウン確認
- [ ] トレード数確認
- [ ] バランス曲線確認
- [ ] レポート保存

### 最適化後
- [ ] 別期間で検証
- [ ] 別通貨ペアで検証
- [ ] オーバーフィッティング確認

---

## 🎯 推奨テストフロー

```
1. 初回動作確認（1年）
   ↓ OK
2. 標準テスト（10年）
   ↓ PF>1.3, DD<15%
3. パラメータ最適化
   ↓ 最良パラメータ発見
4. 検証テスト（別期間）
   ↓ 結果安定
5. 複数通貨ペアテスト
   ↓ ロバスト性確認
6. デモ口座フォワードテスト（3ヶ月）
   ↓ バックテストと乖離小
7. 少額リアル運用
```

---

**作成日:** 2026年2月17日  
**対象EA:** Para372 v1.2  
**対象プラットフォーム:** MetaTrader 5
