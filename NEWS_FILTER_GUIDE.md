# 経済指標停止機能 - 使用ガイド

## v1.2の新機能

372手法改良版EA v1.2では、**経済指標発表前後の自動取引停止機能**が追加されました。

## 機能概要

重要な経済指標発表の前後は相場が急変動するため、指定時間帯の取引を自動的に停止します。

### 停止される取引
- ✅ 新規エントリー
- ✅ ドテンエントリー（決済は実行される）

### 停止されない操作
- 既存ポジションの保有継続
- SL/TPによる自動決済

## パラメータ設定

### 基本設定

```
UseNewsFilter = true               // 経済指標フィルター使用
NewsStopMinutesBefore = 60        // 指標前60分から停止
NewsStopMinutesAfter = 60         // 指標後60分まで停止
StopOn_High_Impact = true         // 高重要度指標で停止
StopOn_Medium_Impact = false      // 中重要度指標で停止
```

### 重要度の定義

| 重要度 | 説明 | 例 |
|-------|------|-----|
| 3（高） | 市場に大きな影響を与える | 雇用統計、政策金利、GDP |
| 2（中） | 一定の影響がある | CPI、小売売上高、PMI |
| 1（低） | 影響は限定的 | 在庫指数、中古住宅販売 |

## 経済指標の登録方法

### 方法1: コード内で直接登録（推奨）

`LoadNewsEvents()`関数内に追加：

```cpp
void LoadNewsEvents()
{
    ArrayResize(newsEvents, 50);
    newsEventsCount = 0;
    
    // 今週の重要指標を登録
    AddNewsEvent("2026.02.17 22:30", "USD", "米国雇用統計", 3);
    AddNewsEvent("2026.02.18 04:00", "USD", "FOMC議事録", 3);
    AddNewsEvent("2026.02.19 16:30", "EUR", "ECB政策金利", 3);
    AddNewsEvent("2026.02.20 22:30", "USD", "新規失業保険申請", 2);
    
    Print("📰 経済指標データ読み込み完了: ", newsEventsCount, "件");
}
```

### 方法2: 毎週の更新手順

1. **ForexFactoryで確認**
   - https://www.forexfactory.com/calendar にアクセス
   - 今週の重要指標をチェック

2. **MT5サーバー時間に変換**
   - ForexFactoryはGMT表示
   - MT5サーバー時間 = GMT + ブローカーのオフセット
   - 例: GMT+2（夏時間）の場合、2時間追加

3. **コードに追加**
   - `LoadNewsEvents()`関数を編集
   - 再コンパイル（F7キー）
   - EAを再起動

### 方法3: 外部ファイル読み込み（今後実装予定）

v2.0で実装予定の機能：
- CSVファイルから自動読み込み
- 毎週自動更新
- WebからのAPIデータ取得

## 使用例

### USD/JPYでの運用例

```cpp
// USD/JPYに関係するUSD指標を登録

AddNewsEvent("2026.02.17 22:30", "USD", "雇用統計", 3);
AddNewsEvent("2026.02.18 04:00", "USD", "FOMC", 3);
AddNewsEvent("2026.02.19 00:00", "USD", "小売売上高", 2);

// 設定
UseNewsFilter = true
StopOn_High_Impact = true      // NFP、FOMCで停止
StopOn_Medium_Impact = false   // 小売売上高では停止しない
```

### EUR/USDでの運用例

```cpp
// EUR/USDに関係するEURとUSD指標を登録

AddNewsEvent("2026.02.17 22:30", "USD", "雇用統計", 3);
AddNewsEvent("2026.02.19 16:30", "EUR", "ECB政策金利", 3);
AddNewsEvent("2026.02.19 18:30", "EUR", "ドラギ総裁会見", 3);

// 設定
UseNewsFilter = true
StopOn_High_Impact = true      // すべての高重要度で停止
StopOn_Medium_Impact = true    // 中重要度でも停止（保守的）
```

## 時間設定の推奨値

### 保守的設定（リスク回避重視）

```
NewsStopMinutesBefore = 120    // 2時間前から停止
NewsStopMinutesAfter = 120     // 2時間後まで停止
StopOn_High_Impact = true
StopOn_Medium_Impact = true
```

**メリット:** 指標の影響を確実に回避  
**デメリット:** トレード機会が減少

### 標準設定（バランス型）

```
NewsStopMinutesBefore = 60     // 1時間前から停止
NewsStopMinutesAfter = 60      // 1時間後まで停止
StopOn_High_Impact = true
StopOn_Medium_Impact = false
```

**メリット:** リスクとチャンスのバランス  
**デメリット:** 中重要度指標の影響は受ける

### アグレッシブ設定（機会重視）

```
NewsStopMinutesBefore = 30     // 30分前から停止
NewsStopMinutesAfter = 30      // 30分後まで停止
StopOn_High_Impact = true
StopOn_Medium_Impact = false
```

**メリット:** トレード機会を最大化  
**デメリット:** 指標の余波の影響を受ける可能性

## 動作確認方法

### ログ出力の確認

```
========================================
✅ 372手法改良版EA v1.2 - 初期化成功
通貨ペア: USDJPY
リスク設定: 2%
経済指標フィルター: 有効
========================================

📰 経済指標データ読み込み完了: 5件
```

### 指標前の動作

```
📰 高重要度指標: 米国雇用統計
   発表時刻: 2026.02.17 22:30
📰 経済指標発表前後のため取引を停止中
```

## トラブルシューティング

### Q1: 指標が登録されていない
```
⚠️ 経済指標が登録されていません
   手動でAddNewsEvent関数を使用して登録してください
```

**対処法:**
- `LoadNewsEvents()`関数内に`AddNewsEvent()`を追加
- 再コンパイル（F7キー）

### Q2: 時間が合わない

**確認事項:**
1. MT5のサーバー時間を確認
   ```
   Print("現在のサーバー時間: ", TimeCurrent());
   ```

2. ForexFactoryの時間をサーバー時間に変換
   ```
   GMT時間 + ブローカーオフセット = サーバー時間
   ```

3. 夏時間・冬時間の切り替えに注意

### Q3: 停止しない

**チェックリスト:**
- [ ] `UseNewsFilter = true`になっているか
- [ ] 指標の重要度と`StopOn_High_Impact`が一致しているか
- [ ] 指標時刻が正しいか
- [ ] 通貨ペアが一致しているか（USD/JPYならUSD指標）

## 主要経済指標カレンダー

### 毎月定期的に発表される指標

#### アメリカ（USD）
| 指標名 | 発表日時 | 重要度 |
|--------|---------|--------|
| 雇用統計（NFP） | 第1金曜日 22:30 | 3 |
| CPI（消費者物価指数） | 月中旬 22:30 | 3 |
| FOMC政策金利 | 年8回 04:00 | 3 |
| GDP速報値 | 四半期末 22:30 | 3 |
| 小売売上高 | 月中旬 22:30 | 2 |

#### ユーロ圏（EUR）
| 指標名 | 発表日時 | 重要度 |
|--------|---------|--------|
| ECB政策金利 | 月1回 21:45 | 3 |
| CPI速報値 | 月末 18:00 | 2 |
| GDP速報値 | 四半期末 18:00 | 2 |

#### 日本（JPY）
| 指標名 | 発表日時 | 重要度 |
|--------|---------|--------|
| 日銀政策金利 | 年8回 12:00 | 3 |
| GDP速報値 | 四半期末 08:50 | 2 |
| CPI | 月末 08:30 | 2 |

## 運用上の注意点

### 1. 毎週の更新が必要
- 経済指標は毎週変わります
- **週初めに必ず更新**してください
- カレンダーサイトを参照

### 2. MT5時間に注意
- ブローカーによってサーバー時間が異なる
- GMT+2、GMT+3が多い
- 必ず自分のブローカーの時間を確認

### 3. 夏時間・冬時間
- 3月・11月に切り替わる
- 指標時刻が1時間ずれる
- 切り替え後は時刻を再確認

### 4. 過去の指標は削除
- 古い指標データは削除推奨
- 月初めにリセット
- メモリ節約のため

## 今後の改善予定（v2.0）

- [ ] CSVファイルからの自動読み込み
- [ ] 羊飼いのFXブログAPIとの連携
- [ ] WebRequestを使った自動更新
- [ ] 週次の自動更新機能
- [ ] 指標発表後の価格安定確認機能

---

**作成日:** 2026年2月17日  
**対象バージョン:** Para372 v1.2
**更新推奨:** 毎週月曜日
