# Para372 EA - v1.2 変更履歴

## バージョン履歴

### v1.2 (2026/02/17) - 経済指標停止機能追加

#### 🎉 新機能

##### 1. **経済指標停止機能の実装**
重要な経済指標発表の前後で自動的に取引を停止する機能を追加しました。

**新しいパラメータ:**
```cpp
input bool UseNewsFilter = true;               // 経済指標フィルター使用
input int NewsStopMinutesBefore = 60;          // 指標前停止時間（分）
input int NewsStopMinutesAfter = 60;           // 指標後停止時間（分）
input bool StopOn_High_Impact = true;          // 高重要度指標で停止
input bool StopOn_Medium_Impact = false;       // 中重要度指標で停止
```

**機能の詳細:**
- 経済指標発表の前後60分間（調整可能）は新規エントリーを停止
- 重要度別のフィルタリング（高・中・低）
- 通貨ペアに関連する指標のみ検知
- ドテンエントリーも停止（決済は実行）

**使用方法:**
```cpp
// LoadNewsEvents()関数内に指標を登録
AddNewsEvent("2026.02.17 22:30", "USD", "米国雇用統計", 3);
AddNewsEvent("2026.02.18 04:00", "USD", "FOMC議事録", 3);
```

##### 2. **ログ出力の改善**
絵文字を使った見やすいログ表示に変更しました。

**変更例:**
```
✅ 買いポジションオープン成功
❌ エントリー見送り: 資金不足
📰 経済指標発表前後のため取引を停止中
💰 勝ちトレード - 連敗カウンターリセット
📉 負けトレード - 連敗カウント: 3
🛑 休止期間開始
📅 月末または月初のため取引を停止中
```

#### 🔧 改善点

##### 1. **v1.1からの統合**
- ロット計算ロジックの修正を反映
- 詳細ログ出力機能を統合
- `VerboseLog`パラメータの追加

##### 2. **エラーメッセージの改善**
- より分かりやすいエラー表示
- 絵文字による視認性向上
- 必要な対処法の提示

##### 3. **初期化メッセージの改善**
```
========================================
✅ 372手法改良版EA v1.2 - 初期化成功
通貨ペア: USDJPY
リスク設定: 2%
経済指標フィルター: 有効
========================================
```

#### 📋 技術的変更

##### 新しいデータ構造
```cpp
struct NewsEvent
{
    datetime time;        // 指標発表時刻
    string currency;      // 通貨（USD, EUR等）
    string title;         // 指標名
    int importance;       // 重要度（1=低、2=中、3=高）
};
```

##### 新しい関数
- `LoadNewsEvents()` - 経済指標データの読み込み
- `AddNewsEvent()` - 経済指標の手動追加
- `IsNewsTime()` - 経済指標時間帯の判定

#### ⚠️ 注意事項

##### 1. **手動での指標登録が必要**
v1.2では経済指標を手動で登録する必要があります。

**更新頻度:** 毎週月曜日を推奨

**更新手順:**
1. ForexFactoryなどのカレンダーサイトで確認
2. `LoadNewsEvents()`関数に追加
3. 再コンパイル（F7キー）
4. EAを再起動

##### 2. **MT5サーバー時間に注意**
- ブローカーによってサーバー時間が異なります
- GMT+2 または GMT+3 が一般的
- 夏時間・冬時間の切り替えに注意

##### 3. **通貨ペアの対応**
現在の実装では、通貨ペア名から自動的に関連通貨を判定します。
- USD/JPY → USD指標を検知
- EUR/USD → EURとUSD指標を検知

---

### v1.1 (2026/02/16) - ロット計算修正

#### 🔴 重大な修正

##### ロット計算ロジックの修正
**問題:** v1.0のロット計算式が不正確

**修正前:**
```cpp
double lotSize = riskAmount / (slPips * tickValue / tickSize);
```

**修正後:**
```cpp
double riskPerLot = slPoints * tickValue;
double lotSize = riskAmount / riskPerLot;
```

#### ✨ 機能追加
- 詳細なログ出力機能
- `VerboseLog`パラメータの追加

---

### v1.0 (2026/02/16) - 初版リリース

#### 実装機能
- 372手法の基本戦略
- ATRベースのSL/TP
- マルチタイムフレームトレンドフィルター
- 負け後の休止機能
- 月末・月初停止機能

---

## v1.0 → v1.1 → v1.2 の比較

| 機能 | v1.0 | v1.1 | v1.2 |
|------|------|------|------|
| 基本戦略（372手法） | ✅ | ✅ | ✅ |
| ロット計算 | ❌ 不正確 | ✅ 修正済み | ✅ 修正済み |
| 詳細ログ | ❌ | ✅ | ✅ 改善 |
| 経済指標停止 | ❌ | ❌ | ✅ **新機能** |
| ログの視認性 | 普通 | 良い | ✅ 優秀（絵文字） |
| VerboseLog | ❌ | ✅ | ✅ |

---

## アップグレード方法

### v1.0/v1.1 から v1.2 へ

#### 1. ファイルの配置
```
古いファイルをバックアップ:
Para372.mq5 → Para372_v1.0_backup.mq5

新しいファイルを配置:
Para372_v1.2.mq5 → Para372.mq5
```

#### 2. 経済指標の登録
`LoadNewsEvents()`関数を編集して今週の指標を登録:

```cpp
void LoadNewsEvents()
{
    ArrayResize(newsEvents, 50);
    newsEventsCount = 0;
    
    // 今週の重要指標
    AddNewsEvent("2026.02.17 22:30", "USD", "米国雇用統計", 3);
    AddNewsEvent("2026.02.18 04:00", "USD", "FOMC議事録", 3);
    // ... 他の指標を追加
    
    Print("📰 経済指標データ読み込み完了: ", newsEventsCount, "件");
}
```

#### 3. 再コンパイルと再起動
1. F7キーでコンパイル
2. チャートからEAを削除
3. 新しいEAを適用
4. パラメータを設定

#### 4. 動作確認
ログに以下が表示されることを確認:
```
✅ 372手法改良版EA v1.2 - 初期化成功
経済指標フィルター: 有効
📰 経済指標データ読み込み完了: X件
```

---

## 既知の問題

### v1.2での制限事項

1. **手動登録が必要**
   - 経済指標を毎週手動で登録する必要がある
   - → v2.0で自動取得機能を実装予定

2. **過去の指標が残る**
   - 古い指標データが蓄積される
   - → 月初めに手動でクリアを推奨

3. **CSVインポート未対応**
   - 外部ファイルからの読み込みができない
   - → v2.0で実装予定

---

## 今後の予定

### v2.0（予定: 2026年3月）
- [ ] CSVファイルからの経済指標自動読み込み
- [ ] 羊飼いのFXブログAPI連携
- [ ] WebRequestによる自動更新
- [ ] ADXフィルター追加
- [ ] スプレッドフィルター追加

### v3.0（予定: 2026年4月）
- [ ] 高度な資金管理機能
- [ ] 複数通貨ペア対応
- [ ] ポートフォリオ管理機能

---

## 更新推奨度

| バージョン | 更新推奨度 | 理由 |
|-----------|-----------|------|
| v1.0 → v1.1 | 🔴 **必須** | ロット計算の不具合修正 |
| v1.1 → v1.2 | 🟡 推奨 | 経済指標停止機能の追加 |

---

## サポート

### ドキュメント
- `README_372EA.md` - 基本的な使用方法
- `NEWS_FILTER_GUIDE.md` - 経済指標機能の詳細説明
- `REQUIRED_CAPITAL.md` - 必要資金ガイド
- `BACKTEST_SETTINGS.md` - バックテスト設定

### 質問・バグ報告
発見したバグや改善要望は、以下の情報と共にご報告ください:
- MT5のバージョン
- ブローカー名
- 通貨ペア
- エラーメッセージ
- ログファイル

---

**作成日:** 2026年2月17日  
**最新バージョン:** v1.2  
**作成者:** Claude (Anthropic)
